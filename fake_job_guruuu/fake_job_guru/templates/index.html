<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fake Job Guru — Analyze</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .card { background: white; border-radius: 14px; box-shadow: 0 10px 30px rgba(2,6,23,0.06); }
    .muted { color: #6b7280; }
    .input-focus:focus { outline: none; box-shadow: 0 0 0 4px rgba(59,130,246,0.08); border-color: #3b82f6; }
    .accent-btn { background-color: #2563eb; color: white; }
    .accent-btn:hover { background-color: #1e40af; }
    .secondary-btn { border: 1px solid #e6e9ef; background: white; color: #374151; }
    .small-muted { font-size: 0.9rem; color: #6b7280; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-sky-50 flex items-center justify-center p-6">

  <div class="w-full max-w-5xl">
    <!-- Header -->
    <header class="mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-indigo-600 to-sky-500 flex items-center justify-center text-white font-bold">FG</div>
          <div>
            <h1 class="text-2xl font-semibold text-slate-800">Fake Job Guru</h1>
            <div class="small-muted">Fast scam analysis for job postings</div>
          </div>
        </div>
        <div class="text-sm muted">Detect scams · Make hiring safer</div>
      </div>
    </header>

    <!-- Main card: full-screen analyze area -->
    <main class="card p-6">
      <div class="md:flex md:space-x-6">
        <!-- Left: Inputs (dominant) -->
        <section class="md:flex-1">
          <label class="text-sm font-medium text-slate-700">Paste Job Description</label>
          <textarea id="description" rows="10" class="w-full mt-2 p-3 border border-gray-200 rounded-lg input-focus" placeholder="Paste the full job posting here..."></textarea>

          <!-- Optional advanced fields (collapsed) -->
          <div class="mt-4">
            <button id="toggleAdvanced" class="text-sm small-muted flex items-center gap-2">
              <svg id="chev" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
              Advanced options
            </button>
            <div id="advanced" class="hidden mt-3 grid grid-cols-1 md:grid-cols-3 gap-3">
              <input id="title" class="p-2 border rounded-lg input-focus" placeholder="Job title (optional)"/>
              <input id="company" class="p-2 border rounded-lg input-focus" placeholder="Company name (optional)"/>
              <input id="followers" type="number" class="p-2 border rounded-lg input-focus" placeholder="Followers (optional)"/>
              <input id="employees" class="p-2 border rounded-lg input-focus" placeholder="Employees (optional)"/>
              <input id="engagement" type="number" min="0" max="10" class="p-2 border rounded-lg input-focus" placeholder="Engagement 0–10 (optional)"/>
            </div>
          </div>

          <!-- Buttons -->
          <div class="mt-5 flex items-center gap-3">
            <button id="analyzeBtn" class="px-6 py-3 rounded-lg accent-btn shadow-sm flex items-center gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
              <span>Analyze Job</span>
            </button>
            <button id="clearBtn" class="px-4 py-3 rounded-lg secondary-btn">Clear</button>
            <div id="status" class="ml-3 small-muted"></div>
          </div>

          <p class="mt-4 small-muted">Tip: Use the Advanced options if you want company signals to be considered.</p>
        </section>

        <!-- Right: Visual helper / preview -->
        <aside class="md:w-96 mt-6 md:mt-0">
          <div class="p-4 border border-gray-100 rounded-lg">
            <h3 class="text-sm font-medium text-slate-700">How it works</h3>
            <p class="small-muted mt-2">We analyze text and company signals, then provide a risk result, explanation, and highlighted red flags. Results open on a separate page for cleaner presentation.</p>

            <div class="mt-4">
              <h4 class="text-sm font-medium">Quick examples</h4>
              <ul class="list-disc list-inside small-muted mt-2">
                <li>“Pay a registration fee” → Red flag</li>
                <li>Missing company activity → Suspicious</li>
              </ul>
            </div>

            <div class="mt-4 text-xs small-muted">© Fake Job Guru</div>
          </div>
        </aside>
      </div>
    </main>
  </div>

<script>
  // small helpers
  function el(id){return document.getElementById(id);}  
  
  // toggle advanced options
  el('toggleAdvanced').addEventListener('click', function(){
    const adv = el('advanced');
    const chev = el('chev');
    adv.classList.toggle('hidden');
    chev.classList.toggle('rotate-180');
  });

  // clear button
  el('clearBtn').addEventListener('click', function(){
    ['description','title','company','followers','employees','engagement'].forEach(id => el(id) && (el(id).value=''));
    el('status').textContent = '';
  });

  // analyze button
  el('analyzeBtn').addEventListener('click', async function(){
    const payload = {
      title: el('title')?.value || '',
      description: el('description')?.value || '',
      followers: el('followers')?.value ? Number(el('followers').value) : undefined,
      employees: el('employees')?.value ? Number(el('employees').value) : undefined,
      engagement: el('engagement')?.value ? Number(el('engagement').value) : undefined
    };

    if(!payload.description || payload.description.trim().length < 20){
      el('status').textContent = 'Please paste a longer job description to analyze.';
      return;
    }

    // show spinner/status
    el('status').innerHTML = 'Analyzing... <svg class="inline-block animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg>';

    try {
      const res = await fetch('/analyze_job', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('Server responded '+res.status);
      const data = await res.json();
      // store and redirect to results page
      sessionStorage.setItem('fakeJobLastAnalysis', JSON.stringify({payload, data}));
      window.location.href = '/results.html';
    } catch (err) {
      el('status').textContent = 'Error: ' + (err.message || 'Network error');
      console.error(err);
    }
  });
</script>

</body>
</html>

