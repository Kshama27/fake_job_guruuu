<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fake Job Guru ‚Äî Analyze</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .card { background: white; border-radius: 14px; box-shadow: 0 10px 30px rgba(2,6,23,0.06); }
    .muted { color: #6b7280; }
    .input-focus:focus { outline: none; box-shadow: 0 0 0 4px rgba(59,130,246,0.08); border-color: #3b82f6; }
    .accent-btn { background-color: #2563eb; color: white; }
    .accent-btn:hover { background-color: #1e40af; }
    .secondary-btn { border: 1px solid #e6e9ef; background: white; color: #374151; }
    .small-muted { font-size: 0.9rem; color: #6b7280; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-50 via-indigo-50 to-purple-100 flex items-center justify-center p-6">

  <div class="w-full max-w-5xl">
    <!-- Header -->
    <header class="mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-indigo-600 to-sky-500 flex items-center justify-center text-white font-bold">FG</div>
          <div>
            <h1 class="text-2xl font-semibold text-slate-800">Fake Job Guru</h1>
            <div class="small-muted">Fast scam analysis for job postings</div>
          </div>
        </div>
        <div class="text-sm muted">Detect scams ¬∑ Make hiring safer</div>
      </div>
    </header>

    <!-- Main card: full-screen analyze area -->
    <main class="card p-6">
      <!-- Full-width form (no right-side panel) -->
      <section>
        <label class="text-sm font-medium text-slate-700">Paste Job Description</label>
        <textarea id="description" rows="10" class="w-full mt-2 p-4 border border-gray-200 rounded-2xl input-focus shadow-sm hover:shadow transition-shadow" placeholder="Paste the full job posting here..."></textarea>

        <!-- Visible metadata fields (no toggle) -->
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
          <input id="title" class="p-3 border rounded-2xl input-focus shadow-sm hover:shadow transition-shadow" placeholder="Job Title (optional)"/>
          <input id="company" class="p-3 border rounded-2xl input-focus shadow-sm hover:shadow transition-shadow" placeholder="Company Profile/Description (optional)"/>
          <input id="followers" type="number" class="p-3 border rounded-2xl input-focus shadow-sm hover:shadow transition-shadow" placeholder="Followers (optional)"/>
          <input id="employees" type="number" class="p-3 border rounded-2xl input-focus shadow-sm hover:shadow transition-shadow" placeholder="Employees (optional)"/>
          <input id="engagement" type="number" min="0" max="10" class="p-3 border rounded-2xl input-focus shadow-sm hover:shadow transition-shadow" placeholder="Engagement 0‚Äì10 (optional)"/>
        </div>

        <!-- Buttons -->
        <div class="mt-6 flex flex-wrap items-center gap-3">
          <button id="analyzeBtn" class="px-7 py-3 rounded-full text-white font-semibold shadow-sm bg-gradient-to-r from-indigo-600 to-sky-500 hover:from-indigo-700 hover:to-sky-600 transition-colors flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
            <span>Analyze Job</span>
          </button>
          <button id="clearBtn" class="px-6 py-3 rounded-full font-semibold border border-gray-300 text-gray-700 hover:bg-white/60 bg-white/80 backdrop-blur transition-colors">Clear</button>
          <div id="status" class="small-muted"></div>
        </div>
      </section>
    </main>
  </div>

<script>
  // small helpers
  function el(id){return document.getElementById(id);}  
  
  // clear button
  el('clearBtn').addEventListener('click', function(){
    ['description','title','company','followers','employees','engagement'].forEach(id => el(id) && (el(id).value=''));
    el('status').textContent = '';
  });

  // analyze button
  el('analyzeBtn').addEventListener('click', async function(){
    const payload = {
      title: el('title')?.value || '',
      description: el('description')?.value || '',
      followers: el('followers')?.value ? Number(el('followers').value) : undefined,
      employees: el('employees')?.value ? Number(el('employees').value) : undefined,
      engagement: el('engagement')?.value ? Number(el('engagement').value) : undefined
    };

    if(!payload.description || payload.description.trim().length < 20){
      el('status').textContent = 'Please paste a longer job description to analyze.';
      return;
    }

    // show spinner/status
    el('status').innerHTML = 'Analyzing... <svg class="inline-block animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg>';

    try {
      const res = await fetch('/analyze', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('Server responded '+res.status);
      const data = await res.json();
      // render inline results on the same page (no redirect)
      renderResultsInline(payload, data);
    } catch (err) {
      el('status').textContent = 'Error: ' + (err.message || 'Network error');
      console.error(err);
    }
  });

  function renderResultsInline(payload, data){
    const containerId = 'inline-results';
    let cont = document.getElementById(containerId);
    if(!cont){
      cont = document.createElement('div');
      cont.id = containerId;
      cont.className = 'mt-6';
      document.querySelector('main')?.appendChild(cont);
    }

    // compute banding
    const riskScore = typeof data.risk_score === 'number' ? (data.risk_score * 100).toFixed(1) : '‚Äî';
    const scamProb = data.probabilities?.scam != null ? (data.probabilities.scam * 100).toFixed(1) : '‚Äî';
    const legitProb = data.probabilities?.legit != null ? (data.probabilities.legit * 100).toFixed(1) : '‚Äî';
    const rsn = Number(riskScore);
    let band = 'green';
    if (!Number.isNaN(rsn) && rsn >= 70) band = 'red';
    else if (!Number.isNaN(rsn) && rsn >= 40) band = 'yellow';
    const bs = band === 'red' ? {bg:'bg-red-50',bd:'border-red-200',tx:'text-red-800',sub:'text-red-600'} : band === 'yellow' ? {bg:'bg-yellow-50',bd:'border-yellow-200',tx:'text-yellow-900',sub:'text-yellow-700'} : {bg:'bg-green-50',bd:'border-green-200',tx:'text-green-800',sub:'text-green-600'};

    const signals = data.signals || {};
    const keywords = signals.keywords_triggered || [];

    // highlighted description
    const raw = (payload?.description || '').toString();
    let highlighted = raw
      .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
      .replaceAll('"','&quot;').replaceAll("'",'&#039;');
    keywords.forEach(k => {
      const re = new RegExp('\\\b' + k.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\$&') + '\\\b', 'gi');
      highlighted = highlighted.replace(re, `<span class="bg-red-100 text-red-800 font-semibold px-1 rounded">${k}</span>`);
    });

    cont.innerHTML = `
      <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-4 sm:p-6">
        <div class="${bs.bg} border ${bs.bd} rounded-xl p-4 sm:p-5 mb-5">
          <div class="flex items-center justify-between gap-4">
            <div>
              <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Risk Assessment</div>
              <h3 class="text-lg font-semibold ${bs.tx} mb-1">${band === 'green' ? 'LEGITIMATE' : band === 'yellow' ? 'SUSPICIOUS' : 'SCAM'}</h3>
              <div class="text-sm ${bs.sub} flex gap-4">
                <div>Risk Score: <span class="font-semibold">${riskScore}%</span></div>
                <div>Scam Prob: <span class="font-semibold">${scamProb}%</span></div>
                <div>Legit Prob: <span class="font-semibold">${legitProb}%</span></div>
              </div>
            </div>
            <div class="text-3xl">${band === 'red' ? 'üö®' : band === 'yellow' ? '‚ö†Ô∏è' : '‚úÖ'}</div>
          </div>
        </div>

        ${raw ? `
        <div class="mb-4">
          <h4 class="font-medium text-gray-900 mb-2">Job description (highlighted):</h4>
          <div class="text-sm leading-6 bg-gray-50 border border-gray-200 rounded p-3">${highlighted}</div>
        </div>` : ''}

        <div class="space-y-4">
          ${keywords.length ? `
          <div>
            <h4 class="font-medium text-gray-900 mb-2">Triggered Keywords:</h4>
            <div class="flex flex-wrap gap-2">
              ${keywords.map(kw => `<span class="px-2.5 py-1 ${band === 'red' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'} text-xs rounded-full">${kw}</span>`).join('')}
            </div>
          </div>` : ''}

          <div>
            <h4 class="font-medium text-gray-900 mb-2">Company Information:</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
              <div class="rounded-lg border border-gray-200 p-3"><div class="text-gray-500 text-xs">Strength</div><div class="mt-0.5 font-semibold ${signals.company_strength === 'weak' ? 'text-red-600' : signals.company_strength === 'medium' ? 'text-yellow-600' : 'text-green-600'}">${signals.company_strength || 'n/a'}</div></div>
              <div class="rounded-lg border border-gray-200 p-3"><div class="text-gray-500 text-xs">Followers</div><div class="mt-0.5 font-semibold">${signals.followers ?? '‚Äî'}</div></div>
              <div class="rounded-lg border border-gray-200 p-3"><div class="text-gray-500 text-xs">Employees</div><div class="mt-0.5 font-semibold">${signals.employees ?? '‚Äî'}</div></div>
              <div class="rounded-lg border border-gray-200 p-3"><div class="text-gray-500 text-xs">Engagement</div><div class="mt-0.5 font-semibold">${signals.engagement ?? '‚Äî'}</div></div>
            </div>
          </div>
        </div>
      </div>
    `;
    el('status').textContent = '';
  }
</script>

</body>
</html>

